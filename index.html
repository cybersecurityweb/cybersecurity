<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Siber GÃ¼venlik</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body class="dark-background">

    <canvas id="neon-lines"></canvas>

    <div class="container">
    <header class="main-header">
        <h1>Daha GÃ¼venli ve Bilgili Bir Ä°nternet Ä°Ã§in SeneryolarÄ± Ziyaret Edin</h1>
        <!-- Bu metni deÄŸiÅŸtirmemiz gerekiyor -->
        <p>
            <span class="text-highlight">Ã–n test ile baÅŸlayÄ±n</span>
            ardÄ±ndan gizlilik, ÅŸifreler, veri bÃ¼tÃ¼nlÃ¼ÄŸÃ¼, gerÃ§eklik, eriÅŸebilirlik ve bilinÃ§li kullanÄ±m konularÄ±nda senoryalarÄ± tamamlayÄ±n.
            <span class="text-highlight">SON TEST</span> ile uygulamayÄ± bitirin.
        </p>
<style>
  /* Vurgulama stili */
  .text-highlight {
    font-weight: 700;
    color: #ffaa00;
  }
</style>
    <a href="#" onclick="startTest('pre')" class="start-button">Ã–n Teste Hemen BaÅŸla</a>
        </header>

        <section class="scenario-grid">
            <a href="gizlilik.html" class="scenario-card-link">
                <div class="scenario-card">
                    <div class="icon-box">
                        <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#FFD700" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-shield-lock"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><rect x="8" y="11" width="8" height="6" rx="1"/><path d="M11 11V8a3 3 0 0 1 6 0v3"/></svg>
                    </div>
                    <h3>Gizlilik</h3>
                    <p>KiÅŸisel bilgilerin korunmasÄ±</p>
                </div>
            </a>
            
            <a href="ÅŸifreler.html" class="scenario-card-link">
                <div class="scenario-card">
                    <div class="icon-box">
                        <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#FFD700" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-key"><path d="M21 2l-6.5 6.5a1.5 1.5 0 0 0 0 2.12c.56.56 1.48.56 2.04 0L21 4"/><path d="M11 11l6.5-6.5"/><path d="M10 20l4-4"/><path d="M20 12l-8 8-4-4-8-8-4-4"/></svg>
                    </div>
                    <h3>Åifreler</h3>
                    <p>Hesap gÃ¼venliÄŸi saÄŸlama</p>
                </div>
            </a>

            <a href="veri_butunlugu.html" class="scenario-card-link">
                <div class="scenario-card">
                    <div class="icon-box">
                        <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#FFD700" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-database"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M3 5v14c0 1.66 4.03 3 9 3s9-1.34 9-3V5"/><path d="M21 12c0 1.66-4.03 3-9 3s-9-1.34-9-3"/></svg>
                    </div>
                    <h3>Veri BÃ¼tÃ¼nlÃ¼ÄŸÃ¼</h3>
                    <p>Verileri kaybetmeye karÅŸÄ± korunma</p>
                </div>
            </a>

            <a href="gerceklik.html" class="scenario-card-link">
                <div class="scenario-card">
                    <div class="icon-box">
                        <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#FFD700" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-alert-triangle"><path d="M10.29 2.05a.5.5 0 0 1 .71-.71l.71-.71A2 2 0 0 1 12 1a2 2 0 0 1 1.29.35l.71.71a.5.5 0 0 1 .71.71l.71.71A2 2 0 0 1 18 10v9a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2v-9a2 2 0 0 1 2-2h1.29l.71-.71z"/><path d="M12 15h.01"/><path d="M12 11V7"/></svg>
                    </div>
                    <h3>GerÃ§eklik</h3>
                    <p>AldatÄ±cÄ± iÃ§erikleri tanÄ±ma</p>
                </div>
            </a>

            <a href="erisebilirlik.html" class="scenario-card-link">
                <div class="scenario-card">
                    <div class="icon-box">
                        <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#FFD700" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-shield-check"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><polyline points="9 12 11 14 15 10"/></svg>
                    </div>
                    <h3>EriÅŸilebilirlik</h3>
                    <p>Cihaz gÃ¼venliÄŸini saÄŸlama</p>
                </div>
            </a>

            <a href="bilincli_kullanim.html" class="scenario-card-link">
                <div class="scenario-card">
                    <div class="icon-box">
                        <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#FFD700" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-message-square-check"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/><polyline points="9 10 12 13 18 7"/></svg>
                    </div>
                    <h3>BilinÃ§li KullanÄ±m</h3>
                    <p>GÃ¼venli internet kullanÄ±mÄ±</p>
                </div>
            </a>
        </section>
    
       <!-- KENDÄ° STÄ°LÄ°NÄ°ZDEKÄ° DÄ°V Ä°Ã‡Ä°NE YERLEÅTÄ°RÄ°N -->
<div class="sayaÃ§-kutusu">
    <!-- SayÄ±yÄ± gÃ¶sterecek olan yer: -->
    <h3 id="ziyaretciSayisi">0</h3> 
    
    <!-- YÃ¼kleniyor veya Durum mesajÄ±nÄ± gÃ¶sterecek olan yer: -->
    <p id="yukleniyorText">Toplam Ziyaret: YÃ¼kleniyor...</p>
    
    <p>kaÃ§ kez ziyaret edildiÄŸini gÃ¶sterir.</p>
</div>

        <!-- index.html iÃ§erisindeki Son Test butonu/linki (Ã–rn: Scenario kartÄ±) -->
    <a href="#" onclick="startTest('post')" class="scenario-card-link">
            <div class="scenario-card final-test-card">
                <div class="icon-box">
                    <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#FFD700" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-check-circle"><path d="M22 11.08V12a10 10 0 1 1-5.93-8.66"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                </div>
                <h3>Son Testi Ã‡Ã¶z</h3>
                <p>Bilgilerinizi test edin ve sertifikanÄ±zÄ± alÄ±n</p>
            </div>
        </a>
    </div>

    <script src="neon_lines.js"></script>
    <script src="interactives.js"></script>

    <script>
    // ğŸ”¥ğŸ”¥ğŸ”¥ KRÄ°TÄ°K ADIM: GOOGLE FORM GÃ–MME (EMBED) LÄ°NKLERÄ°NÄ°ZÄ° BURAYA YAPIÅTIRIN!
    
    // Google Form'unuzu aÃ§Ä±n -> "GÃ¶nder" (Send) -> "<>" (Embed HTML) sekmesindeki src="" kÄ±smÄ±nÄ± kopyalayÄ±n.

    const PRE_TEST_FORM_URL = "https://docs.google.com/forms/d/e/1FAIpQLSfeSQbovF4xUreMJXHepynB_2TZRWelHv_97DBRTm6WHtYk7Q/viewform"; 
    const POST_TEST_FORM_URL = "https://docs.google.com/forms/d/e/1FAIpQLSePz6ODD-XbxzE770r783pmUfSH3J6aqVqz1a4tF_6jUz7SRg/viewform";
    
    // Ã–rnek GÃ¶mme Linki FormatÄ±: 
    // const PRE_TEST_FORM_URL = "https://docs.google.com/forms/d/e/1FAIpQLSfp_k7zT1hY8gWwzZ.../viewform?embedded=true";
    
    
    /**
     * ButonlarÄ±nÄ±zÄ± tetikleyecek ana fonksiyon.
     * @param {('pre'|'post')} testType - Hangi testin aÃ§Ä±lacaÄŸÄ± (Ã¶n veya son).
     */
    window.startTest = function(testType) {
        let url;
        if (testType === 'pre') {
            url = PRE_TEST_FORM_URL;
        } else if (testType === 'post') {
            url = POST_TEST_FORM_URL;
        } else {
            return;
        }
        
        // Formu yeni pencerede/sekmede aÃ§mak iÃ§in:
        window.open(url, '_blank'); 
        
        // AynÄ± pencerede aÃ§mak iÃ§in:
        // window.location.href = url;
    };
</script>


  <script type="module">
    // Firebase ModÃ¼llerini Import Et
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getFirestore, doc, onSnapshot, runTransaction, increment, setLogLevel, collection, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

    // Hata ayÄ±klama (Debug) seviyesini aÃ§ar.
    setLogLevel('debug');

    // Sizin paylaÅŸtÄ±ÄŸÄ±nÄ±z Firebase Config bilgileri
    const firebaseConfig = {
        apiKey: "AIzaSyDdkl1ZV3f2opyXwcNFbEZHRvWcSTgLLJ4",
        authDomain: "cybersecurity-test-analytics.firebaseapp.com",
        projectId: "cybersecurity-test-analytics", 
    };
    
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    
    // SayaÃ§ verisinin bulunduÄŸu Firestore yolu
    const STATS_DOC_REF = doc(db, 'meta', 'visitor_count'); 
    // Ziyaret eden IP adreslerini tutan koleksiyon
    const VISITED_IPS_COLLECTION = collection(db, 'visited_ips');


    /**
     * Harici bir API kullanarak kullanÄ±cÄ±nÄ±n genel IP adresini alÄ±r.
     * @returns {Promise<string|null>} KullanÄ±cÄ±nÄ±n IP adresi veya hata durumunda null.
     */
    async function getClientIpAddress(statusMessageElement) {
        if(statusMessageElement) statusMessageElement.textContent = "IP adresi alÄ±nÄ±yor...";
        try {
            // Harici bir servis aracÄ±lÄ±ÄŸÄ±yla IP adresini alÄ±yoruz. 
            // Bu, tarayÄ±cÄ± gÃ¼venliÄŸi nedeniyle doÄŸrudan mÃ¼mkÃ¼n olan tek yoldur.
            const response = await fetch('https://api64.ipify.org?format=json');
            const data = await response.json();
            
            if(statusMessageElement) statusMessageElement.textContent = "IP adresi alÄ±ndÄ±.";
            return data.ip;

        } catch (error) {
            console.error("IP adresi alma hatasÄ±:", error);
            if(statusMessageElement) statusMessageElement.textContent = `ğŸš¨ HATA: IP adresi alÄ±namadÄ±. ${error.message}`;
            return null;
        }
    }


    /**
     * IP adresine gÃ¶re tekil ziyareti kontrol eder ve sayacÄ± artÄ±rÄ±r.
     * @param {string} ipAddress - ZiyaretÃ§inin IP adresi.
     * @param {HTMLElement} statusMessageElement - Durum mesajlarÄ±nÄ±n gÃ¶sterileceÄŸi element.
     */
    async function handleUniqueVisit(ipAddress, statusMessageElement) {
        
        // Firestore dokÃ¼man ID'leri iÃ§in IP adreslerini noktalarÄ±ndan arÄ±ndÄ±r.
        const ipDocId = ipAddress.replace(/\./g, '_'); 
        const ipDocRef = doc(VISITED_IPS_COLLECTION, ipDocId);

        try {
            // 1. IP'nin daha Ã¶nce ziyaret edip etmediÄŸini kontrol et
            if(statusMessageElement) statusMessageElement.textContent = `IP (${ipAddress}) kontrol ediliyor...`;
            const ipDoc = await getDoc(ipDocRef);

            if (ipDoc.exists()) {
                // IP ZATEN KAYITLI: SayacÄ± artÄ±rma.
                console.log("Bu IP zaten kayÄ±tlÄ±. SayaÃ§ artÄ±rÄ±lmayacak.");
                if(statusMessageElement) statusMessageElement.textContent = "Bu IP zaten ziyaret etmiÅŸ. SayaÃ§ artÄ±rÄ±lmadÄ±.";
                return; 
            }

            // 2. IP YENÄ°: Hem sayacÄ± artÄ±r hem de IP'yi kaydet
            if(statusMessageElement) statusMessageElement.textContent = "Yeni IP! SayaÃ§ artÄ±rÄ±lÄ±yor ve IP kaydediliyor...";
            
            await runTransaction(db, async (transaction) => {
                // A. SayacÄ± artÄ±r
                const currentStatsDoc = await transaction.get(STATS_DOC_REF);
                
                if (!currentStatsDoc.exists) {
                    // DokÃ¼man yoksa, 1 olarak oluÅŸtur
                    transaction.set(STATS_DOC_REF, { count: 1, last_ip: ipAddress });
                } else {
                    // Varsa, sayacÄ± 1 artÄ±r
                    transaction.update(STATS_DOC_REF, {
                        count: increment(1),
                        last_ip: ipAddress 
                    });
                }

                // B. Yeni IP'yi kaydet
                transaction.set(ipDocRef, {
                    ip: ipAddress,
                    first_visit: new Date().toISOString()
                });
            });

            console.log("Yeni IP: SayaÃ§ baÅŸarÄ±yla artÄ±rÄ±ldÄ± ve IP kaydedildi.");
            if(statusMessageElement) statusMessageElement.textContent = `Yeni ziyaretÃ§i algÄ±landÄ±! SayaÃ§ artÄ±rÄ±ldÄ±.`;

        } catch (e) {
            console.error("IP BazlÄ± SayaÃ§ Ä°ÅŸlemi BaÅŸarÄ±sÄ±z oldu: ", e);
            if (e.code === 'permission-denied') {
                 if(statusMessageElement) statusMessageElement.textContent = "ğŸš¨ HATA: Firebase Ä°zni Reddedildi (KurallarÄ± Kontrol Et)!";
            } else {
                 if(statusMessageElement) statusMessageElement.textContent = `ğŸš¨ HATA: SayaÃ§ artÄ±rÄ±lamadÄ±: ${e.message}`;
            }
        }
    }


    document.addEventListener('DOMContentLoaded', async () => {
        const countSpan = document.getElementById('ziyaretciSayisi'); 
        const statusMessage = document.getElementById('yukleniyorText'); 
        
        // HTML ID kontrolÃ¼ (Ã–nceki hatadan dolayÄ±)
        if (!countSpan || !statusMessage) {
             console.error("HATA: HTML'de sayaÃ§ ID'leri ('ziyaretciSayisi' veya 'yukleniyorText') bulunamadÄ±!");
             return; 
        }

        try {
            statusMessage.textContent = "BaÄŸlantÄ± kuruluyor...";
            
            // Anonim oturum aÃ§ma (Firestore okuma/yazma izni iÃ§in zorunlu)
            await signInAnonymously(auth);
            
            // 1. IP Adresini Al
            const clientIp = await getClientIpAddress(statusMessage);
            
            if (clientIp) {
                // 2. IP BazlÄ± Tekil Ziyaret Ä°ÅŸlemini BaÅŸlat
                await handleUniqueVisit(clientIp, statusMessage);
            } else {
                // IP alÄ±namadÄ±ysa, iÅŸlem durur.
                return;
            }


            // 3. SayaÃ§ deÄŸerini anlÄ±k olarak dinlemeye baÅŸla
            onSnapshot(STATS_DOC_REF, 
                // BaÅŸarÄ±lÄ± Okuma Durumu
                (docSnapshot) => {
                    const data = docSnapshot.data();
                    const currentCount = data?.count || 0;
                    
                    countSpan.textContent = currentCount; 
                    // EÄŸer IP alÄ±namasa bile, sayaÃ§ deÄŸerini gÃ¶ster
                    if(statusMessage.textContent.startsWith("ğŸš¨ HATA:")) return;
                    statusMessage.textContent = `Toplam Tekil Ziyaret: ${currentCount} (AnlÄ±k Veri)`;
                }, 
                // Hata Durumu (GÃ¼venlik KuralÄ± HatasÄ±)
                (error) => {
                    console.error("FIREBASE HATA: SayaÃ§ Dinleme BaÅŸarÄ±sÄ±z:", error);
                    if (error.code === 'permission-denied') {
                         statusMessage.textContent = "ğŸš¨ KESÄ°N HATA: Okuma Ä°zni Reddedildi! GÃ¼venlik KurallarÄ±nÄ± Kontrol Et!";
                         countSpan.textContent = "KURAL HATASI";
                    } else {
                         statusMessage.textContent = `ğŸš¨ HATA: SayaÃ§ okunamadÄ±: ${error.message}`;
                         countSpan.textContent = "HATA";
                    }
                }
            );
            
        } catch (error) {
            console.error("Firebase BaÅŸlatma/Oturum HatasÄ±:", error);
            statusMessage.textContent = `ğŸš¨ BAÄLANTI HATASI: ${error.message}`;
            countSpan.textContent = "HATA";
        }
    });
</script>
</body>
<html>